/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   main.c                                             :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: pabonnin <marvin@42.fr>                    +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2017/10/09 15:04:46 by pabonnin          #+#    #+#             */
/*   Updated: 2017/10/21 17:13:11 by pabonnin         ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#include "wolf.h"
#include "libft.h"

int			map(int x, int y)
{
	static int	map[20][20] = {
		{1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
		{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1},
		{1, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1},
		{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1},
		{1, 0, 0, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 0, 1},
		{1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 0, 1},
		{1, 0, 1, 0, 1, 0, 1, 1, 0, 0, 0, 0, 0, 1, 1, 0, 1, 0, 0, 1},
		{1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 1, 1, 0, 1, 0, 0, 1},
		{1, 0, 1, 0, 1, 0, 1, 1, 0, 0, 1, 1, 0, 1, 1, 0, 1, 0, 0, 1},
		{1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 1, 1, 0, 1, 0, 0, 1},
		{1, 0, 1, 0, 1, 0, 1, 1, 0, 0, 1, 1, 0, 1, 1, 0, 1, 0, 0, 1},
		{1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 1, 1, 0, 1, 0, 0, 1},
		{1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 1, 1, 0, 1, 0, 0, 1},
		{1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 1, 1, 1, 0, 1, 0, 0, 1},
		{1, 0, 1, 0, 0, 0, 1, 1, 0, 0, 1, 1, 1, 1, 1, 0, 1, 0, 0, 1},
		{1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1},
		{1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1},
		{1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1},
		{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1},
		{1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1}};

	return (map[x][y]);
}

void		ft_loop(t_env *e)
{
	mlx_hook(e->win, 2, (1L << 0), ft_key_hook, (void *)e);
	mlx_hook(e->win, 3, (1L << 1), ft_key_release, (void *)e);
	mlx_hook(e->win, 17, (1L << 17), quit, (void *)e);
	ft_draw_o_redraw(e);
	mlx_loop_hook(e->mlx, ft_key_release, (void *)e);
	mlx_loop(e->mlx);
}

void		ft_draw_o_redraw(t_env *e)
{
	e->img = mlx_xpm_file_to_image(e->mlx, "img/blue-sky-33562.xpm",
			&(e->s_l), &(e->bpp));
	e->data = mlx_get_data_addr(e->img, &(e->bpp), &(e->s_l), &(e->endian));
	raycasting(e);
	mlx_put_image_to_window(e->data, e->win, e->img, 0, 0);
	mlx_destroy_image(e->mlx, e->img);
}

void		map_init(void)
{
	t_env	*e;

	e = (t_env *)malloc(sizeof(t_env));
	e->map_x = 0;
	e->map_y = 0;
	mlxinit(e);
	player_init(e);
	ft_draw_o_redraw(e);
	ft_loop(e);
}

int			main(int ac, char **av)
{
	if (ac != 1)
	{
		ft_putstr_fd("Usage : ./wolf3d", 2);
		exit(1);
	}
	map_init();
	return (av[0][0] + ac);
}
